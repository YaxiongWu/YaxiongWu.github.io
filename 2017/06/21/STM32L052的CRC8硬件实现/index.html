<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C" /><title> STM32L052的CRC8硬件实现 · 吴亚雄的博客</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="STM32L052的CRC8硬件实现 - wuyaxiong"><meta name="keywords"><meta name="author" content="wuyaxiong"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="吴亚雄的博客"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="首页" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/categories/硬件/" target="_self" data-hover="硬件" class="nav-list-link">硬件</a></li><li class="nav-list-item"><a href="/categories/软件/" target="_self" data-hover="软件" class="nav-list-link">软件</a></li><li class="nav-list-item"><a href="/categories/其他/" target="_self" data-hover="其他" class="nav-list-link">其他</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">STM32L052的CRC8硬件实现</h1><div class="post-info">2017-06-21 19:26</div><div class="post-content"><h2 id="1-基本原理"><a href="#1-基本原理" class="headerlink" title="1. 基本原理"></a>1. 基本原理</h2><p>　CRC是一种数据校验方式，以CRC8为例，如果有一个字节数组，实现过程是：要校验的字节与一个特定的字节（我们暂且叫做多项式字节）相异或，得出的结果再与前一个字节的结果异或，得出的结果再与多项式字节异或，所得的结果为校验值。这个多项式字节是根据科学计算得出的，能让”数据出错但校验位又没有出错“这种情况发生的概率最低，一般CRC8采用下面三种多项式：<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x8+x5+x4+1           0x31（0x131）</div><div class="line">x8+x2+x1+1           0x07（0x107） </div><div class="line">x8+x6+x4+x3+x2+x1    0x5E（0x15E）</div></pre></td></tr></table></figure> </p>
<h2 id="2-c语言实现"><a href="#2-c语言实现" class="headerlink" title="2. c语言实现"></a>2. c语言实现</h2><p>　　由于计算一个字节两次要与多项式字节做异或运算，一般可以采用查表的方式更快得到以后结果<br>　　如果采用多项式 x8+x5+x4+1，那么0-255与多项式相异或的结果如下表所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">const uint8_t CRC8Table[]=&#123;    </div><div class="line"> 0x00,0x31,0x62,0x53,0xc4,0xf5,0xa6,0x97,0xb9,0x88,0xdb,0xea,0x7d,0x4c,0x1f,0x2e,</div><div class="line">   0x43,0x72,0x21,0x10,0x87,0xb6,0xe5,0xd4,0xfa,0xcb,0x98,0xa9,0x3e,0x0f,0x5c,0x6d,</div><div class="line">   0x86,0xb7,0xe4,0xd5,0x42,0x73,0x20,0x11,0x3f,0x0e,0x5d,0x6c,0xfb,0xca,0x99,0xa8,</div><div class="line">   0xc5,0xf4,0xa7,0x96,0x01,0x30,0x63,0x52,0x7c,0x4d,0x1e,0x2f,0xb8,0x89,0xda,0xeb,</div><div class="line">   0x3d,0x0c,0x5f,0x6e,0xf9,0xc8,0x9b,0xaa,0x84,0xb5,0xe6,0xd7,0x40,0x71,0x22,0x13,</div><div class="line">   0x7e,0x4f,0x1c,0x2d,0xba,0x8b,0xd8,0xe9,0xc7,0xf6,0xa5,0x94,0x03,0x32,0x61,0x50,</div><div class="line">   0xbb,0x8a,0xd9,0xe8,0x7f,0x4e,0x1d,0x2c,0x02,0x33,0x60,0x51,0xc6,0xf7,0xa4,0x95,</div><div class="line">   0xf8,0xc9,0x9a,0xab,0x3c,0x0d,0x5e,0x6f,0x41,0x70,0x23,0x12,0x85,0xb4,0xe7,0xd6,</div><div class="line">   0x7a,0x4b,0x18,0x29,0xbe,0x8f,0xdc,0xed,0xc3,0xf2,0xa1,0x90,0x07,0x36,0x65,0x54,</div><div class="line">   0x39,0x08,0x5b,0x6a,0xfd,0xcc,0x9f,0xae,0x80,0xb1,0xe2,0xd3,0x44,0x75,0x26,0x17,</div><div class="line">   0xfc,0xcd,0x9e,0xaf,0x38,0x09,0x5a,0x6b,0x45,0x74,0x27,0x16,0x81,0xb0,0xe3,0xd2,</div><div class="line">   0xbf,0x8e,0xdd,0xec,0x7b,0x4a,0x19,0x28,0x06,0x37,0x64,0x55,0xc2,0xf3,0xa0,0x91,</div><div class="line">   0x47,0x76,0x25,0x14,0x83,0xb2,0xe1,0xd0,0xfe,0xcf,0x9c,0xad,0x3a,0x0b,0x58,0x69,</div><div class="line">   0x04,0x35,0x66,0x57,0xc0,0xf1,0xa2,0x93,0xbd,0x8c,0xdf,0xee,0x79,0x48,0x1b,0x2a,</div><div class="line">   0xc1,0xf0,0xa3,0x92,0x05,0x34,0x67,0x56,0x78,0x49,0x1a,0x2b,0xbc,0x8d,0xde,0xef,</div><div class="line">   0x82,0xb3,0xe0,0xd1,0x46,0x77,0x24,0x15,0x3b,0x0a,0x59,0x68,0xff,0xce,0x9d,0xac</div><div class="line">&#125;;</div></pre></td></tr></table></figure><br>使用下面的函数就可以得到一个字节数组的CRC8校验值了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line"> uint8_t CRC8_Table(uint8_t *p, uint8_t counter)    </div><div class="line">&#123;    </div><div class="line"> uint8_t crc8 = 0xff;        </div><div class="line"> for( ; counter &gt; 0; counter--)&#123;    </div><div class="line">   crc8 = CRC8Table[crc8^*p];</div><div class="line">   p++;</div><div class="line">  &#125;    </div><div class="line">  return crc8;        </div><div class="line">&#125;    </div></pre></td></tr></table></figure></p>
<h2 id="3-在stm32l052中实现CRC"><a href="#3-在stm32l052中实现CRC" class="headerlink" title="3. 在stm32l052中实现CRC"></a>3. 在stm32l052中实现CRC</h2><p>　　由于CRC在数据传输中要经常用到，Stm32l052有专门的硬件CRC，可以完成7、8、16和32位的CRC， 在官方给出的实例中，实现的是默认32位CRC，下面介绍的如何使用硬件完成CRC8:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">CrcHandle.Instance = CRC;   </div><div class="line">CrcHandle.Init.DefaultPolynomialUse    = DEFAULT_POLYNOMIAL_DISABLE;//DEFAULT_POLYNOMIAL_ENABLE;</div><div class="line">CrcHandle.Init.DefaultInitValueUse     = DEFAULT_INIT_VALUE_ENABLE;</div><div class="line">CrcHandle.Init.InputDataInversionMode  = CRC_INPUTDATA_INVERSION_NONE;</div><div class="line">CrcHandle.Init.OutputDataInversionMode = CRC_OUTPUTDATA_INVERSION_DISABLE;</div><div class="line">CrcHandle.InputDataFormat              = CRC_INPUTDATA_FORMAT_BYTES;//CRC_INPUTDATA_FORMAT_WORDS;</div><div class="line">CrcHandle.Init.CRCLength=CRC_POLYLENGTH_8B;</div><div class="line">CrcHandle.Init.GeneratingPolynomial=0x31;</div><div class="line">HAL_CRC_DeInit(&amp;CrcHandle);</div><div class="line">HAL_CRC_Init(&amp;CrcHandle);</div><div class="line"></div><div class="line">if(HAL_CRC_Init(&amp;CrcHandle) != HAL_OK)</div><div class="line">&#123;   </div><div class="line"> Error_Handler();</div><div class="line">&#125;</div><div class="line">uwCRCValue = HAL_CRC_Accumulate(&amp;CrcHandle, (uint32_t *)aDataBuffer,24);// BUFFER_SIZE);</div></pre></td></tr></table></figure><br>注意以下几个参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">CrcHandle.Init.DefaultPolynomialUse    = DEFAULT_POLYNOMIAL_DISABLE; </div><div class="line">CrcHandle.InputDataFormat              = CRC_INPUTDATA_FORMAT_BYTES;</div><div class="line">CrcHandle.Init.CRCLength =    CRC_POLYLENGTH_8B;</div><div class="line">CrcHandle.Init.GeneratingPolynomial = 0x31;</div><div class="line"> </div></pre></td></tr></table></figure><br>　前三个参数是指定使用CRC8，后面GeneratingPolynomial 是多项式，去掉最高位，如 （x8+x5+x4+1）设置为0x31，在实例代码和说明书中，默认的32位CRC为X^32 + X^26 + X^23 + X^22 + X^16 + X^12 + X^11 + X^10 +X^8 + X^7 + X^5 + X^4 + X^2+ X +1，去掉最高位，对应设置的值为0x4C11DB7。</p>
<div class="tip"><br>　注意<p><br>　如果设置了为8位，在计算时，HAL_CRC_Accumulate函数的第二个参数虽然是32位的，但最后一个参数是指有多个个字节，这个参数到底是以8位、16位还是32位算，是与设置InputDataFormat相关的.</p><p><br>　最后注意使用硬件和代码分别实现时，初始值设置要一致。</p><p><br>　通过验证，硬件实现的CRC8与代码实现的一致。<br></p></div> </div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/硬件/">硬件</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/硬件/stm32/">stm32</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/硬件/树莓派/">树莓派</a><span class="category-list-count">1</span></li></ul></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/ADC/" style="font-size: 10px;">ADC</a> <a href="/tags/DMA/" style="font-size: 20px;">DMA</a> <a href="/tags/SPI/" style="font-size: 10px;">SPI</a> <a href="/tags/UART/" style="font-size: 10px;">UART</a> <a href="/tags/crc8/" style="font-size: 10px;">crc8</a> <a href="/tags/lorawan/" style="font-size: 10px;">lorawan</a> <a href="/tags/sw连接/" style="font-size: 10px;">sw连接</a> <a href="/tags/写保护/" style="font-size: 10px;">写保护</a> <a href="/tags/格式说明/" style="font-size: 10px;">格式说明</a> <a href="/tags/静态IP/" style="font-size: 10px;">静态IP</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/树莓派P3设置静态IP/">树莓派P3设置静态IP</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/STM32L052的CRC8硬件实现/">STM32L052的CRC8硬件实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/STM32的ADC测量电压/">STM32的ADC测量电压</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/STM32-Spi-DMA/">STM32 Spi DMA</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/STM32f103-uart-dma-printf串口终极方案/">STM32f103 uart dma printf串口终极方案</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2017/06/21/树莓派P3设置静态IP/" class="prev">PREV</a><a href="/2017/06/21/STM32的ADC测量电压/" class="next">NEXT</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script>var cloudTieConfig = {
    url: document.location.href, 
    sourceId: "",
    productKey: "656e246ebfc7420d82eb5d9a339b50c2",
    target: "cloud-tie-wrapper"
};</script><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><div class="copyright"><p>© 2016 - 2017 <a href="/about/index.html" target="_blank">wuyaxiong</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a>.</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>